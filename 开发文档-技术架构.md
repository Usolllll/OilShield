# OilShield 企业油价风险管理平台 - 技术架构文档

## 目录

- [1. 项目概述](#1-项目概述)
- [2. 技术架构](#2-技术架构)
- [3. 技术栈选型](#3-技术栈选型)
- [4. 项目文件结构](#4-项目文件结构)

---

## 1. 项目概述

### 1.1 项目简介

**OilShield（油御）** 是一个企业级油价风险管理与智能决策平台，旨在帮助航空、化工、制造、物流等油品依赖型企业识别、量化和对冲油价波动风险。

### 1.2 核心功能

1. **风险总览仪表盘**：展示当前油价数据和预测数据，可视化图表展示
2. **企业风险健康度诊断**：用户填写企业信息表单，调用模型组API获取健康度评分
3. **油价预测与多情景分析**：展示数据组提供的不同情景预测数据
4. **对冲策略模拟与方案对比**：用户填写策略表单，调用模型组API获取多个策略方案
5. **AI 油价风险日报与报告中心**：用户信息管理、历史档案查看、总结看板

---

## 2. 技术架构

### 2.1 架构设计

采用**按功能模块划分**的全栈开发架构，每个开发人员负责一个完整的功能模块（包含前端页面和后端API）：

```
┌───────────────────────────────────────────────────────────────────┐
│                      OilShield 平台                               │
├─────────────────┬─────────────────┬─────────────────┬────────────┤
│  认证模块        │  仪表盘模块      │  风险诊断模块    │  预测模块 │
│ (用户/登录)      │ (数据总览)       │ (健康度诊断)     │ (价格预测)│
│ • 登录页面       │ • 仪表盘页面     │ • 诊断表单页面   │ • 预测页面│
│ • 注册页面       │ • 数据图表       │ • 健康度展示     │ • 情景分析│
│ • 认证API        │ • 仪表盘API      │ • 风险分析API    │ • 预测API │
├─────────────────┼─────────────────┼─────────────────┼──────────┤
│  策略模块        │  报告模块        │  数据服务模块    │ 公共模块  │
│ (对冲策略)       │ (AI日报)         │ (油价数据)       │ (共享组件)│
│ • 策略表单       │ • 日报页面       │ • 数据采集       │ • Header  │
│ • 方案对比       │ • 报告历史       │ • 预测数据存储   │ • Sidebar │
│ • 策略API        │ • 报告生成API    │ • 外部API封装    │ • 工具函数│
└─────────────────┴─────────────────┴─────────────────┴──────────┘
                            │
          ┌─────────────────┴───────────────────┐
          │           数据存储层                 │
          ├─────────────────────────────────────┤
          │  MySQL                              │
          └─────────────────────────────────────┘
                            │
          ┌─────────────────┴─────────────────┐
          │          外部服务层                │
          │  模型API | OpenAI | 油价数据API    │
          └───────────────────────────────────┘
```

### 2.2 架构特点

- **功能模块化**：按业务功能划分模块，每人负责一个完整模块（前端+后端）
- **独立开发**：各模块相对独立，减少团队成员间的代码冲突
- **技术统一**：Flask 模板渲染 + React 组件，统一技术栈
- **职责明确**：每个模块包含自己的页面、API、业务逻辑和数据模型
- **共享资源**：公共组件、工具函数、数据服务模块供所有功能模块复用
- **服务解耦**：外部服务（模型API、AI服务）统一在数据服务模块中调用

---

## 3. 技术栈选型

### 3.1 核心技术栈

| 技术               | 版本  | 用途                      |
| ------------------ | ----- | ------------------------- |
| **后端框架**       |       |                           |
| Python             | 3.11+ | 后端开发语言              |
| Flask              | 3.0+  | Web 框架（路由+模板）     |
| Flask-SQLAlchemy   | 3.1+  | 数据库ORM                 |
| Flask-JWT-Extended | 4.6+  | 用户认证                  |
| Jinja2             | 3.x   | 模板引擎                  |
| **前端技术**       |       |                           |
| React              | 18.x  | 前端UI框架（CDN引入）     |
| Ant Design         | 5.x   | UI组件库（CDN引入）       |
| Ant Design Charts  | 2.x   | 图表组件（CDN引入）       |
| Axios              | 1.x   | HTTP请求（CDN引入）       |
| **数据库**         |       |                           |
| Pandas             | 2.x   | 数据分析                  |
| NumPy              | 1.x   | 数值计算                  |
| **外部服务**       |       |                           |
| Requests           | 2.31+ | HTTP客户端（调用外部API） |

### 3.2 数据存储

| 技术  | 版本 | 用途                                                 |
| ----- | ---- | ---------------------------------------------------- |
| MySQL | 8.x  | 主数据库（用户、企业、预测数据、策略方案、报告档案） |
| Redis | 7.x  | 缓存、会话管理                                       |

### 3.3 开发工具

| 技术           | 版本 | 用途         |
| -------------- | ---- | ------------ |
| Docker         | 25.x | 容器化       |
| Docker Compose | 2.x  | 开发环境编排 |

---

## 4. 项目文件结构

```
OilShield/
├── frontend/                          # 前端项目
│   ├── src/
│   │   ├── modules/                   # 功能模块
│   │   │   ├── auth/                  # 1. 用户认证模块
│   │   │   │   ├── Login.jsx
│   │   │   │   ├── Register.jsx
│   │   │   │   └── auth.css
│   │   │   │
│   │   │   ├── dashboard/             # 2. 风险总览仪表盘模块
│   │   │   │   ├── CurrentPrice.jsx   # 当前油价展示
│   │   │   │   ├── PredictionChart.jsx # 预测数据图表
│   │   │   │   ├── Overview.jsx       # 总览组件
│   │   │   │   └── dashboard.css
│   │   │   │
│   │   │   ├── diagnosis/             # 3. 企业风险健康度诊断模块
│   │   │   │   ├── DiagnosisForm.jsx  # 表单组件
│   │   │   │   ├── HealthScore.jsx    # 健康度展示
│   │   │   │   └── diagnosis.css
│   │   │   │
│   │   │   ├── scenario/              # 4. 油价预测与多情景分析模块
│   │   │   │   ├── ScenarioChart.jsx  # 情景图表
│   │   │   │   ├── ScenarioList.jsx   # 情景列表
│   │   │   │   └── scenario.css
│   │   │   │
│   │   │   ├── strategy/              # 5. 对冲策略模拟与方案对比模块
│   │   │   │   ├── StrategyForm.jsx   # 表单组件
│   │   │   │   ├── SolutionCompare.jsx # 方案对比
│   │   │   │   └── strategy.css
│   │   │   │
│   │   │   └── report/                # 6. AI油价风险日报与报告中心模块
│   │   │       ├── UserProfile.jsx    # 用户信息组件
│   │   │       ├── Archives.jsx       # 历史档案列表
│   │   │       ├── SummaryBoard.jsx   # 总结看板
│   │   │       └── report.css
│   │   │
│   │   ├── shared/                    # 公共资源
│   │   │   ├── components/            # 公共React组件
│   │   │   │   ├── Header.jsx
│   │   │   │   ├── Sidebar.jsx
│   │   │   │   ├── Loading.jsx
│   │   │   │   └── Charts.jsx         # 通用图表组件
│   │   │   ├── utils/                 # 工具函数
│   │   │   │   ├── format.js
│   │   │   │   ├── validation.js
│   │   │   │   └── request.js         # HTTP请求封装
│   │   │   └── styles/                # 全局样式
│   │   │       ├── global.css
│   │   │       ├── variables.css
│   │   │       └── theme.css
│   │   │
│   │   ├── App.jsx                    # 根组件
│   │   └── main.jsx                   # 入口文件
│   │
│   ├── public/
│   │   ├── index.html
│   │   ├── logo.png
│   │   └── favicon.ico
│   │
│   ├── package.json
│   ├── vite.config.js
│   └── .gitignore
│
├── backend/                           # 后端项目
│   ├── modules/                       # 功能模块
│   │   ├── auth/                      # 1. 用户认证模块
│   │   │   ├── routes.py              # Flask路由
│   │   │   ├── services.py            # 用户认证逻辑
│   │   │   ├── models.py              # 用户模型
│   │   │   └── __init__.py
│   │   │
│   │   ├── dashboard/                 # 2. 风险总览仪表盘模块
│   │   │   ├── routes.py
│   │   │   ├── services.py            # 从数据库读取数据
│   │   │   ├── models.py
│   │   │   └── __init__.py
│   │   │
│   │   ├── diagnosis/                 # 3. 企业风险健康度诊断模块
│   │   │   ├── routes.py
│   │   │   ├── services.py            # 调用模型组API获取健康度
│   │   │   ├── models.py              # 企业信息模型
│   │   │   └── __init__.py
│   │   │
│   │   ├── scenario/                  # 4. 油价预测与多情景分析模块
│   │   │   ├── routes.py
│   │   │   ├── services.py            # 读取数据组提供的情景数据
│   │   │   ├── models.py              # 情景数据模型
│   │   │   └── __init__.py
│   │   │
│   │   ├── strategy/                  # 5. 对冲策略模拟与方案对比模块
│   │   │   ├── routes.py
│   │   │   ├── services.py            # 调用模型组API获取策略方案
│   │   │   ├── models.py              # 策略方案模型
│   │   │   └── __init__.py
│   │   │
│   │   └── report/                    # 6. AI油价风险日报与报告中心模块
│   │       ├── routes.py
│   │       ├── services.py            # 报告查询与管理
│   │       ├── models.py              # 报告模型
│   │       └── __init__.py
│   │
│   ├── shared/                        # 公共资源
│   │   ├── utils/                     # Python工具函数
│   │   │   ├── calculator.py
│   │   │   ├── logger.py
│   │   │   └── helpers.py
│   │   └── api_clients/               # 外部API客户端（共享）
│   │       ├── model_api.py           # 模型组API封装
│   │       ├── data_api.py            # 数据组API封装
│   │       └── __init__.py
│   │
│   ├── core/                          # 核心配置（全局）
│   │   ├── config.py                  # 配置管理
│   │   ├── security.py                # 安全相关（JWT、密码）
│   │   ├── database.py                # 数据库连接
│   │   ├── extensions.py              # Flask扩展
│   │   └── __init__.py
│   │
│   ├── database/                      # 数据库相关
│   │   ├── migrations/                # 数据库迁移脚本
│   │   │   └── mysql/
│   │   ├── seeds/                     # 种子数据
│   │   │   ├── users.sql
│   │   │   └── test_data.sql
│   │   └── schemas/                   # 数据库设计
│   │       └── mysql_schema.md
│   │
│   ├── tests/                         # 后端测试
│   │   ├── test_auth/
│   │   ├── test_dashboard/
│   │   ├── test_diagnosis/
│   │   ├── test_scenario/
│   │   ├── test_strategy/
│   │   ├── test_report/
│   │   └── conftest.py
│   │
│   ├── app.py                         # Flask应用入口
│   ├── .env                           # 环境变量
│   ├── .env.example
│   ├── requirements.txt               # Python依赖
│   ├── requirements-dev.txt
│   └── .gitignore
│
├── docs/                              # 文档
│   ├── api.md                         # API文档
│   ├── database.md                    # 数据库设计
│   └── module_guide.md                # 模块开发指南
│
├── .gitignore
├── README.md
├── 开发文档.md                       # 功能方案文档
├── 开发文档-技术架构.md              # 本文档
└── LICENSE
```

### 模块责任划分

| 模块        | 负责人     | 功能描述                                                      | 前端位置                          | 后端位置                     |
| ----------- | ---------- | ------------------------------------------------------------- | --------------------------------- | ---------------------------- |
| `auth`      | 开发者A    | 用户登录注册、JWT认证、会话管理                               | `frontend/src/modules/auth/`      | `backend/modules/auth/`      |
| `dashboard` | 开发者B    | **仪表盘**：从数据库读取当前油价和预测数据，用图表展示        | `frontend/src/modules/dashboard/` | `backend/modules/dashboard/` |
| `diagnosis` | 开发者C    | **风险诊断**：用户填表→调用模型组API→展示企业健康度评分       | `frontend/src/modules/diagnosis/` | `backend/modules/diagnosis/` |
| `scenario`  | 开发者D    | **情景分析**：展示数据组提供的不同情景预测数据                | `frontend/src/modules/scenario/`  | `backend/modules/scenario/`  |
| `strategy`  | 开发者E    | **对冲策略**：用户填表→调用模型组API→展示多个策略方案进行对比 | `frontend/src/modules/strategy/`  | `backend/modules/strategy/`  |
| `report`    | 开发者F    | **报告中心**：用户信息管理、历史档案查看、总结看板展示        | `frontend/src/modules/report/`    | `backend/modules/report/`    |
| `shared`    | 所有人共享 | 公共组件、工具函数、API客户端封装                             | `frontend/src/shared/`            | `backend/shared/`            |

### 开发组与外部组接口说明

| 外部组 | 提供内容                           | 开发组使用方式                      |
| ------ | ---------------------------------- | ----------------------------------- |
| 数据组 | 当前油价数据、预测情景数据         | 通过API获取并存入数据库，前端展示   |
| 模型组 | 企业健康度评估API、对冲策略推荐API | 用户填表后调用API，将结果展示给用户 |

**注意**：开发组不需要了解模型组和数据组的具体实现细节，只需按照API文档调用接口即可。

---

## 附录

### A. 环境变量配置

#### `.env`

```env
# 应用配置
DEBUG=True
FLASK_ENV=development
SECRET_KEY=dev-secret-key

# 数据库
DATABASE_URL=mysql+pymysql://root:password@localhost:3306/oilshield?charset=utf8mb4
REDIS_URL=redis://localhost:6379/0

# JWT
JWT_SECRET_KEY=dev-jwt-secret
ACCESS_TOKEN_EXPIRE_MINUTES=1440


```

### B. 快速开始

#### 前端开发

```bash
cd frontend
npm install
npm run dev              # http://localhost:5173
```

#### 后端开发

```bash
cd backend
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
python app.py            # http://localhost:5000
```

### C. 模块开发指南

#### 开发一个新功能模块的步骤：

**前端部分**：

1. 在 `frontend/src/modules/your_module/` 创建模块目录
2. 创建 React 组件（`.jsx` 文件）和样式文件（`.css`）
3. 在 `App.jsx` 中添加路由配置
4. 使用 `frontend/src/shared/` 中的公共组件和工具

**后端部分**：

1. 在 `backend/modules/your_module/` 创建模块目录
2. 创建必要文件：
   - `routes.py` - Flask路由
   - `services.py` - 业务逻辑
   - `models.py` - 数据模型
   - `__init__.py`
3. 在 `backend/app.py` 中导入并注册蓝图
4. 使用 `backend/shared/api_clients/` 中的封装好的客户端调用外部API
5. 在 `backend/tests/test_your_module/` 中编写测试用例

**注意**：前端使用 `.jsx` 扩展名，后端 Python 文件使用 `.py` 扩展名。

---

## 更新日志

### v1.0.0 (2026-01-20)

- 初始版本
- 完成5个核心功能模块设计
- 完成技术栈选型
- 完成项目文件结构设计
- 明确开发组与模型组/数据组的接口职责
